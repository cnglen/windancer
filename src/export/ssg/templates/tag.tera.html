<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Org Mode">
    <meta name="HandheldFriendly" content="true">
    <meta name="MobileOptimized" content="width">

    <title>{{tag}}</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" href="/default.css" />

    <script>
      document.addEventListener('DOMContentLoaded', function() {
          const tocSiteBtn = document.querySelector('.mobile-toc-site-button');
          const tocPageBtn = document.querySelector('.mobile-toc-page-button');
          const siteSidebar = document.querySelector('.toc-sidebar-site');
          const pageSidebar = document.querySelector('.toc-sidebar-page');
          const overlay = document.querySelector('.sidebar-overlay');

          function isTouchDevice() {
              return 'ontouchstart' in window || navigator.maxTouchPoints > 0 || navigator.msMaxTouchPoints > 0;
          }


          function shouldPreventClose(element) {
              if (!element) return false;
    
              var tagName = element.tagName.toLowerCase();
    
              var preventElements = ['a', 'button', 'input', 'textarea', 'select'];
    
              if (preventElements.includes(tagName)) {
                  return true;
              }
    
              var preventClasses = ['no-close', 'dropdown', 'accordion', 'toggle'];
              for (var i = 0; i < preventClasses.length; i++) {
                  if (element.classList.contains(preventClasses[i])) {
                      return true;
                  }
              }
    
              if (element.closest('a, button, [role="button"], [role="link"]')) {
                  return true;
              }
    
              return false;
          }
  
          function closeAllSidebars() {
              if (siteSidebar) siteSidebar.classList.remove('active');
              if (pageSidebar) pageSidebar.classList.remove('active');
              if (overlay) overlay.classList.remove('active');
              document.body.classList.remove('sidebar-active');
          }
  

          function openSidebar(sidebar) {
              closeAllSidebars();
              if (sidebar) {
                  sidebar.classList.add('active');
                  if (overlay) overlay.classList.add('active');
                  document.body.classList.add('sidebar-active');
              }
          }
  
          function toggleSidebar(sidebar) {
              if (!sidebar) return closeAllSidebars();
    
              if (sidebar.classList.contains('active')) {
                  closeAllSidebars();
              } else {
                  openSidebar(sidebar);
              }
          }
  
          function setupSidebarClickHandler(sidebar) {
              if (!sidebar) return;
              
              sidebar.addEventListener('click', function(e) {
                  var target = e.target;
                  
                  if (shouldPreventClose(target)) {
                      if (target.tagName === 'A' && target.getAttribute('href') && target.getAttribute('href').startsWith('#')) {
                          e.preventDefault();
                          var targetId = target.getAttribute('href').substring(1);
                          var targetElement = document.getElementById(targetId);
                          
                          setTimeout(function() {
                              closeAllSidebars();
                              if (targetElement) {
                                  targetElement.scrollIntoView({ behavior: 'smooth' });
                              }
                          }, 100);
                      }

                      return;
                  }
                  
                  if (sidebar.classList.contains('active')) {
                      closeAllSidebars();
                  }
              });
          }
          
          if (tocSiteBtn && siteSidebar) {
              tocSiteBtn.addEventListener('click', function(e) {
                  e.stopPropagation();
                  toggleSidebar(siteSidebar);
              });
          }
          
          if (tocPageBtn && pageSidebar) {
              tocPageBtn.addEventListener('click', function(e) {
                  e.stopPropagation();
                  toggleSidebar(pageSidebar);
              });
          }
          
          setupSidebarClickHandler(siteSidebar);
          setupSidebarClickHandler(pageSidebar);
          
          if (overlay) {
              overlay.addEventListener('click', function(e) {
                  e.stopPropagation();
                  closeAllSidebars();
              });
          }
          
          document.addEventListener('click', function(e) {
              var isSidebarClick = 
                  (siteSidebar && (siteSidebar === e.target || siteSidebar.contains(e.target))) ||
                  (pageSidebar && (pageSidebar === e.target || pageSidebar.contains(e.target))) ||
                  (tocSiteBtn && (tocSiteBtn === e.target || tocSiteBtn.contains(e.target))) ||
                  (tocPageBtn && (tocPageBtn === e.target || tocPageBtn.contains(e.target)));
              
              if (!isSidebarClick) {
                  closeAllSidebars();
              }
          });
          
          document.addEventListener('keydown', function(e) {
              if (e.key === 'Escape') {
                  closeAllSidebars();
              }
          });          

      });          
    </script>
  </head>

  <body>
    <div class="sidebar-overlay"></div>
    
    <main id="main-content" class="content main-content" role="main">
      <nav class="toc-sidebar-site" aria-label="site-navigation" role="navigation">
        <div>â˜° Site Navigation </div>
        <div id="text-table-of-contents" role="doc-toc">
          {{ toc }}
        </div>
      </nav>
      
      <article id="page">
        <header>
          <div class="article-container">
            <button class="mobile-toc-site-button"> â˜° </button>
            <div class="header-actions"> 
              <!-- <form role="search" aria-label="search">  -->
              <!--   <input type="search" placeholder="Search..."> -->
              <!-- </form>  -->
            </div> 
            <button class="mobile-toc-page-button"> ðŸ“– </button>
          </div>

          <h1 class="title">{{tag}}</h1>
        </header>

        <div>
          <ul>
            {% for url_title in url_titles %}            
            <li>
              <a href={{url_title.0}}>{{url_title.1}}</a>
            </li>
            {% endfor%}            
          </ul>
        </div>

      </article>
    </main>

    <footer class="site-footer" role="contentinfo">
      {% include "site_footer.tera.html" ignore missing %}
    </footer>    
  </body>
</html>




